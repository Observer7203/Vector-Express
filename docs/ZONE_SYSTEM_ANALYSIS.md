# Анализ систем зонирования для Vector Express

## Содержание
1. [Введение](#введение)
2. [Как работают зоны у крупных перевозчиков](#как-работают-зоны-у-крупных-перевозчиков)
3. [Системы зон для СНГ и Казахстана](#системы-зон-для-снг-и-казахстана)
4. [Сравнительный анализ систем](#сравнительный-анализ-систем)
5. [Рекомендация для Vector Express](#рекомендация-для-vector-express)
6. [Техническая реализация](#техническая-реализация)

---

## Введение

### Что делает наш сервис

**Vector Express** — это метапоисковик логистических услуг, который:
1. Агрегирует предложения от разных перевозчиков
2. Рассчитывает стоимость по их тарифам
3. Показывает клиенту лучшие варианты

### Где используются зоны в нашем сервисе

```
Панель перевозчика → Зоны доставки → Настройка географических зон для расчета тарифов
```

**Кто создаёт зоны:** Логистические компании (перевозчики), которые регистрируются на платформе.

**Для чего:** Чтобы настроить свои тарифы между различными географическими точками.

---

## Как работают зоны у крупных перевозчиков

### DHL Express

**Источник:** [DHL Service & Rate Guide 2025](https://mydhl.express.dhl/content/dam/downloads/kz/ru/rate-guide/service_and_rate_guide_kz_ru_2025.pdf.coredownload.pdf)

**Система:** Номерные зоны 1-10 (или буквенные A-I в зависимости от страны отправления)

```
Пример зон DHL из Казахстана:
┌──────────┬───────────────────────────────────────────┐
│ Зона 2   │ Россия, Узбекистан, Кыргызстан           │
│ Зона 3   │ Армения, Азербайджан, Грузия, Беларусь   │
│ Зона 4   │ Китай, Монголия                          │
│ Зона 5   │ Турция, Иран, Пакистан                   │
│ Зона 6   │ Западная Европа (DE, FR, GB, IT)         │
│ Зона 7   │ Восточная Европа, Ближний Восток         │
│ Зона 8   │ Азия (JP, KR, SG, IN)                    │
│ Зона 9   │ Северная и Южная Америка                 │
│ Зона 10  │ Африка, Океания, удалённые территории    │
└──────────┴───────────────────────────────────────────┘
```

**Важно:** У каждой страны отправления СВОЯ таблица зон! Зона 2 из Казахстана — это не то же самое, что Зона 2 из Германии.

### FedEx

**Источник:** [FedEx Zone Guide](https://www.fedex.com/ratetools/RateToolsMain.do)

**Система:** Зоны 1-8 для внутренних, буквенные коды для международных

```
Внутри США: Zone 1-8 (по расстоянию от ZIP-кода отправителя)
Международные: Регион отправления + Регион назначения → Буквенная зона (A, B, C...)

Пример:
- Бразилия (регион OF) → Канада (регион OB) = Зона B
```

### UPS

**Источник:** [Understanding FedEx and UPS Shipping Zones](https://www.auditshipment.com/blog/fedex-and-ups-shipping-zones/)

**Система:** Зоны 1-8 по расстоянию

```
Zone 2: 0-150 миль от точки отправления
Zone 3: 150-300 миль
Zone 4: 300-600 миль
Zone 5: 600-1000 миль
Zone 6: 1000-1400 миль
Zone 7: 1400-1800 миль
Zone 8: 1800+ миль
```

### СДЭК (СНГ)

**Источник:** [СДЭК Калькулятор](https://cdek.kz/ru/online-stores/tariffs/)

**Система:** НЕ использует понятие "зоны" в явном виде

```
Тарификация по:
- Город отправления
- Город назначения
- Тип тарифа (Экспресс, Посылка, Магистральный)
- Вес/объём

Зоны скрыты внутри системы — пользователь видит только конечную цену.
```

### Pony Express (СНГ)

**Источник:** [Pony Express Казахстан](https://ponyexpress.kz/)

**Система:** Страновая тарификация + внутренние зоны

```
Международные: По странам (KZ, RU, UZ, KG, BY...)
Внутри страны: По городам/регионам

Тарифы публикуются в PDF с разбивкой по:
- Странам ЕАЭС (Россия, Беларусь, Армения, Кыргызстан)
- Остальным странам СНГ
- Дальнему зарубежью
```

### Казпочта / EMS

**Источник:** [Казпочта тарифы](https://qazpost.kz/ru/help/tariffs)

**Система:** Региональные группы

```
Тарифные группы:
- Южная Америка
- Африка
- Австралия и Океания
- Центральная Америка
- Азия
- Европа
- СНГ
```

---

## Системы зон для СНГ и Казахстана

### Особенности рынка СНГ

1. **ЕАЭС (Евразийский экономический союз)** — упрощённое таможенное оформление между: Россия, Казахстан, Беларусь, Армения, Кыргызстан

2. **Большие расстояния** — даже внутри одной страны (Казахстан: 2700 км с запада на восток)

3. **Разная инфраструктура** — крупные города vs удалённые районы

4. **Языковая специфика** — названия городов на русском/казахском/местных языках

### Типичные системы зонирования для локальных перевозчиков

#### Вариант 1: По странам
```
KZ — Казахстан
RU — Россия
UZ — Узбекистан
KG — Кыргызстан
BY — Беларусь
```
**Плюсы:** Простота, понятность
**Минусы:** Не учитывает различия внутри страны

#### Вариант 2: По регионам внутри страны
```
KZ-ALM — Алматы и область
KZ-AST — Астана и область
KZ-SHY — Шымкент
KZ-AKT — Актобе
KZ-ATY — Атырау
KZ-KRG — Караганда
KZ-REM — Удалённые районы
```
**Плюсы:** Точное ценообразование
**Минусы:** Сложнее настраивать

#### Вариант 3: По расстоянию от хаба
```
Z1 — 0-200 км от центрального склада
Z2 — 200-500 км
Z3 — 500-1000 км
Z4 — 1000-2000 км
Z5 — 2000+ км
```
**Плюсы:** Логичная привязка к затратам
**Минусы:** Нужно знать координаты

#### Вариант 4: Смешанная (как у крупных перевозчиков)
```
Уровень 1: Страна (ISO код)
Уровень 2: Внутренняя зона (номер или код региона)

Пример:
KZ-1 — Алматы, Астана, Шымкент (крупные города)
KZ-2 — Областные центры
KZ-3 — Удалённые районы
RU-MSK — Москва
RU-SPB — Санкт-Петербург
RU-REG — Регионы России
```

---

## Сравнительный анализ систем

### Сравнение подходов

| Критерий | ISO коды стран | Номерные зоны | Региональные коды | Смешанная |
|----------|---------------|---------------|-------------------|-----------|
| **Простота настройки** | ★★★★★ | ★★★☆☆ | ★★☆☆☆ | ★★★☆☆ |
| **Гибкость** | ★★☆☆☆ | ★★★☆☆ | ★★★★★ | ★★★★★ |
| **Точность тарифов** | ★★☆☆☆ | ★★★☆☆ | ★★★★★ | ★★★★☆ |
| **Понятность клиенту** | ★★★★★ | ★★★☆☆ | ★★★☆☆ | ★★★★☆ |
| **Масштабируемость** | ★★★★☆ | ★★★★★ | ★★★☆☆ | ★★★★★ |

### Что используют аналоги-агрегаторы

| Платформа | Система зон | Особенности |
|-----------|-------------|-------------|
| **Freightos** | ISO страны + порты | UN/LOCODE для точных локаций |
| **Shippo** | Зоны перевозчика | Импортируют зоны каждого carrier |
| **ShipStation** | ISO страны | Простая страновая модель |
| **Flexport** | Порты/терминалы | Фокус на морские/авиа хабы |

---

## Рекомендация для Vector Express

### Предлагаемая система: **Многоуровневая с автоопределением**

```
┌─────────────────────────────────────────────────────────────────┐
│                    СИСТЕМА ЗОН VECTOR EXPRESS                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Уровень 1: ТИП СИСТЕМЫ (выбирает перевозчик)                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ ○ По странам (ISO коды) — для международных             │   │
│  │ ○ По регионам — для внутри страны                       │   │
│  │ ○ По расстоянию (зоны 1-9) — для экспресс-доставки     │   │
│  │ ○ Смешанная — страна + регион                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Уровень 2: АВТОЗАПОЛНЕНИЕ                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ При выборе страны:                                       │   │
│  │   zone_code = ISO код (KZ, RU, CN)                      │   │
│  │   zone_name = Название страны                           │   │
│  │                                                          │   │
│  │ Перевозчик может изменить на свой формат:               │   │
│  │   zone_code = "CIS-1", "EUR-2", "Z3"                    │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  Уровень 3: ПРЕДУСТАНОВЛЕННЫЕ ШАБЛОНЫ                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ "СНГ базовый" — 10 стран СНГ с ISO кодами              │   │
│  │ "Казахстан регионы" — 17 областей + 3 города           │   │
│  │ "ЕАЭС" — 5 стран союза                                  │   │
│  │ "Международный" — группы по континентам                 │   │
│  │ "DHL-style" — зоны 1-10                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Почему эта система лучше

1. **Гибкость** — каждый перевозчик выбирает удобную ему систему
2. **Простота старта** — шаблоны для быстрой настройки
3. **Совместимость** — поддержка форматов крупных перевозчиков
4. **Локализация** — учитывает специфику СНГ и Казахстана

### Конкретные изменения в коде

#### 1. Добавить поле `zone_type` в таблицу `carriers`

```sql
ALTER TABLE carriers ADD COLUMN zone_type ENUM(
    'country',      -- По странам (ISO)
    'region',       -- По регионам внутри страны
    'distance',     -- По расстоянию (Z1-Z9)
    'mixed'         -- Страна + регион
) DEFAULT 'country';
```

#### 2. Изменить логику автозаполнения

```javascript
function onCountryChange() {
  const carrier = currentCarrier.value
  const country = countries.find(c => c.code === newZone.value.country_code)

  if (!country) return

  switch (carrier.zone_type) {
    case 'country':
      // ISO код как zone_code
      newZone.value.zone_code = country.code
      newZone.value.zone_name = country.name
      break

    case 'distance':
      // Предложить следующий номер зоны
      const nextZone = zones.value.length + 1
      newZone.value.zone_code = `Z${nextZone}`
      newZone.value.zone_name = country.name
      break

    case 'region':
      // Код страны + номер
      newZone.value.zone_code = `${country.code}-1`
      newZone.value.zone_name = country.name
      break

    case 'mixed':
      // ISO код по умолчанию
      newZone.value.zone_code = country.code
      newZone.value.zone_name = country.name
      break
  }
}
```

#### 3. Добавить шаблоны зон

```javascript
const zoneTemplates = {
  'cis-basic': {
    name: 'СНГ базовый',
    zones: [
      { code: 'KZ', name: 'Казахстан' },
      { code: 'RU', name: 'Россия' },
      { code: 'UZ', name: 'Узбекистан' },
      { code: 'KG', name: 'Кыргызстан' },
      { code: 'TJ', name: 'Таджикистан' },
      { code: 'TM', name: 'Туркменистан' },
      { code: 'BY', name: 'Беларусь' },
      { code: 'AZ', name: 'Азербайджан' },
      { code: 'AM', name: 'Армения' },
      { code: 'GE', name: 'Грузия' },
    ]
  },
  'eaeu': {
    name: 'ЕАЭС',
    zones: [
      { code: 'KZ', name: 'Казахстан' },
      { code: 'RU', name: 'Россия' },
      { code: 'BY', name: 'Беларусь' },
      { code: 'AM', name: 'Армения' },
      { code: 'KG', name: 'Кыргызстан' },
    ]
  },
  'kazakhstan-regions': {
    name: 'Казахстан по регионам',
    zones: [
      { code: 'KZ-ALM', name: 'Алматы' },
      { code: 'KZ-AST', name: 'Астана' },
      { code: 'KZ-SHY', name: 'Шымкент' },
      { code: 'KZ-AKM', name: 'Акмолинская область' },
      { code: 'KZ-AKT', name: 'Актюбинская область' },
      { code: 'KZ-ALM-O', name: 'Алматинская область' },
      { code: 'KZ-ATY', name: 'Атырауская область' },
      { code: 'KZ-VKO', name: 'Восточно-Казахстанская область' },
      { code: 'KZ-ZHA', name: 'Жамбылская область' },
      { code: 'KZ-ZKO', name: 'Западно-Казахстанская область' },
      { code: 'KZ-KAR', name: 'Карагандинская область' },
      { code: 'KZ-KOS', name: 'Костанайская область' },
      { code: 'KZ-KYZ', name: 'Кызылординская область' },
      { code: 'KZ-MAN', name: 'Мангистауская область' },
      { code: 'KZ-PAV', name: 'Павлодарская область' },
      { code: 'KZ-SKO', name: 'Северо-Казахстанская область' },
      { code: 'KZ-TUR', name: 'Туркестанская область' },
    ]
  },
  'international-groups': {
    name: 'Международный (по группам)',
    zones: [
      { code: 'CIS', name: 'СНГ' },
      { code: 'EAEU', name: 'ЕАЭС' },
      { code: 'EUR', name: 'Европа' },
      { code: 'ASIA', name: 'Азия' },
      { code: 'ME', name: 'Ближний Восток' },
      { code: 'NA', name: 'Северная Америка' },
      { code: 'LATAM', name: 'Латинская Америка' },
      { code: 'AFR', name: 'Африка' },
      { code: 'OCE', name: 'Океания' },
    ]
  },
  'dhl-style': {
    name: 'DHL-style (1-10)',
    zones: [
      { code: 'Z1', name: 'Зона 1 (локальная)' },
      { code: 'Z2', name: 'Зона 2 (соседние страны)' },
      { code: 'Z3', name: 'Зона 3 (региональная)' },
      { code: 'Z4', name: 'Зона 4 (континентальная)' },
      { code: 'Z5', name: 'Зона 5 (межконтинентальная)' },
      { code: 'Z6', name: 'Зона 6' },
      { code: 'Z7', name: 'Зона 7' },
      { code: 'Z8', name: 'Зона 8' },
      { code: 'Z9', name: 'Зона 9' },
      { code: 'Z10', name: 'Зона 10 (удалённая)' },
    ]
  }
}
```

---

## Техническая реализация

### Изменения в базе данных

```sql
-- 1. Добавить тип зонирования к перевозчику
ALTER TABLE carriers ADD COLUMN zone_type VARCHAR(20) DEFAULT 'country';

-- 2. Индекс для быстрого поиска
CREATE INDEX idx_carrier_zones_code ON carrier_zones(carrier_id, zone_code);

-- Существующая структура carrier_zones остаётся:
-- - zone_code: строка до 10 символов (KZ, Z1, KZ-ALM, CIS)
-- - zone_name: название зоны
-- - country_code: ISO код страны (для привязки к гео)
-- - description: описание
```

### Изменения в UI

#### Форма создания зоны (обновлённая)

```
┌─────────────────────────────────────────────────────────────┐
│ Новая зона доставки                                    [X] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ Быстрый старт: [Выберите шаблон ▼]                         │
│   ○ СНГ базовый (10 стран)                                 │
│   ○ ЕАЭС (5 стран)                                         │
│   ○ Казахстан по регионам                                  │
│   ○ Международный (по группам)                             │
│   ○ DHL-style (зоны 1-10)                                  │
│   ────────────────────────                                  │
│   ○ Создать вручную                                        │
│                                                             │
│ ─────────────────────────────────────────────────────────── │
│                                                             │
│ Страна: [Казахстан ▼]                                      │
│ (При выборе страны код и название заполнятся автоматически)│
│                                                             │
│ ┌──────────────┐  ┌─────────────────────────────────────┐  │
│ │ Код зоны     │  │ Название зоны                       │  │
│ │ [KZ        ] │  │ [Казахстан                        ] │  │
│ └──────────────┘  └─────────────────────────────────────┘  │
│                                                             │
│ Описание: [                                               ] │
│                                                             │
│ Почтовые коды:                                             │
│ [Префикс] [Город    ] [Регион  ] [☐ Удалённый] [+]        │
│                                                             │
│                              [Отмена] [Создать зону]       │
└─────────────────────────────────────────────────────────────┘
```

### Логика работы

```
1. Перевозчик регистрируется
   ↓
2. Выбирает тип зонирования (country/region/distance/mixed)
   ↓
3. Может применить шаблон (СНГ, ЕАЭС, и т.д.)
   ↓
4. Или создавать зоны вручную с автозаполнением
   ↓
5. Настраивает тарифы между зонами
   ↓
6. Система использует зоны для расчёта цен
```

---

## Итоговые рекомендации

### Для Vector Express рекомендуется:

1. **По умолчанию** — использовать ISO коды стран (KZ, RU, CN)
   - Просто и понятно
   - Международный стандарт
   - Легко масштабировать

2. **Для локальных перевозчиков Казахстана** — предложить шаблон "Казахстан по регионам"
   - 17 областей + 3 города республиканского значения
   - Точное ценообразование внутри страны

3. **Для международных** — предложить шаблон по группам (CIS, EUR, ASIA)
   - Упрощает настройку для сотен стран
   - Логичная группировка по тарифам

4. **Добавить шаблоны** — быстрый старт для новых перевозчиков
   - СНГ базовый
   - ЕАЭС
   - Казахстан по регионам
   - DHL-style

5. **Сохранить гибкость** — перевозчик может использовать любую систему кодов
   - Свои коды (ABC-1, ZONE-A)
   - Номерные (Z1-Z10)
   - ISO (KZ, RU)
   - Региональные (KZ-ALM)

---

## Источники

- [DHL Service & Rate Guide 2025 Kazakhstan](https://mydhl.express.dhl/content/dam/downloads/kz/ru/rate-guide/service_and_rate_guide_kz_ru_2025.pdf.coredownload.pdf)
- [DHL Zone Guide 2025](https://www.dhl.com/discover/content/dam/ireland/shipping-with-dhl/getting-started/important-documents-2025/DHL%20Zone%20Guide%20%202025.pdf)
- [FedEx Rate Tools](https://www.fedex.com/ratetools/RateToolsMain.do)
- [Understanding FedEx and UPS Shipping Zones](https://www.auditshipment.com/blog/fedex-and-ups-shipping-zones/)
- [СДЭК Тарифы Казахстан](https://cdek.kz/ru/online-stores/tariffs/)
- [Pony Express Казахстан](https://ponyexpress.kz/)
- [Казпочта тарифы](https://qazpost.kz/ru/help/tariffs)
- [ISO 3166 Country Codes](https://www.iso.org/iso-3166-country-codes.html)
- [UN/LOCODE System](https://www.soloplan.com/logistics-lexicon/un-locode/)
- [Shipping Zones Guide](https://warespace.com/articles/shipping-and-packaging-insights/shipping-zones-guide)

---

## Версия документа

- **Версия:** 1.0
- **Дата:** 2025-12-11
- **Автор:** Vector Express Development Team
