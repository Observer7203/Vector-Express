# План Админ-панели Vector Express

## 1. Обзор

Админ-панель нужна для:
- Управления пользователями и компаниями
- Верификации перевозчиков
- Настройки тарифов и интеграций
- Мониторинга заказов и платежей
- Аналитики и отчётов

---

## 2. Структура меню

```
/admin
├── /dashboard          - Главная (статистика)
├── /users              - Пользователи
├── /companies          - Компании
│   ├── /shippers       - Заказчики
│   └── /carriers       - Перевозчики
├── /carriers           - Настройки перевозчиков (carriers)
├── /orders             - Заказы
├── /shipments          - Заявки на расчёт
├── /invoices           - Счета и платежи
├── /reviews            - Отзывы
└── /settings           - Настройки системы
```

---

## 3. Детальное описание разделов

### 3.1 Dashboard (Главная)

**Виджеты статистики:**
- Всего пользователей / новых за неделю
- Всего компаний (заказчиков / перевозчиков)
- Заказов сегодня / на этой неделе / за месяц
- Общая сумма заказов
- Комиссия платформы (5%)
- Ожидающие верификации компании

**Графики:**
- Заказы по дням (линейный график)
- Распределение по типам перевозок (pie chart)
- Топ-5 перевозчиков по заказам

---

### 3.2 Пользователи (/admin/users)

**Список пользователей:**
| Поле | Описание |
|------|----------|
| ID | Уникальный идентификатор |
| Имя | ФИО пользователя |
| Email | Электронная почта |
| Роль | customer / carrier / admin |
| Компания | Привязанная компания |
| Email подтверждён | Да/Нет |
| Дата регистрации | Когда зарегистрировался |
| Статус | Активен / Заблокирован |

**Действия:**
- Просмотр профиля
- Редактирование
- Блокировка/Разблокировка
- Сброс пароля
- Удаление
- Войти как пользователь (impersonate)

---

### 3.3 Компании (/admin/companies)

#### 3.3.1 Заказчики (Shippers)

**Список:**
| Поле | Описание |
|------|----------|
| ID | Идентификатор |
| Название | Название компании |
| ИНН/БИН | Налоговый номер |
| Телефон | Контактный телефон |
| Email | Email компании |
| Верифицирована | Да/Нет |
| Заказов | Количество заказов |
| Сумма заказов | Общая сумма |
| Баланс | Задолженность |

#### 3.3.2 Перевозчики (Carriers)

**Список:**
| Поле | Описание |
|------|----------|
| ID | Идентификатор |
| Название | Название компании |
| ИНН/БИН | Налоговый номер |
| Рейтинг | Средний рейтинг (1-5) |
| Верифицирована | Да/Нет |
| Carrier настроен | Да/Нет (есть ли запись в carriers) |
| Выполнено заказов | Количество |
| Статус | Активен / На модерации / Заблокирован |

**Действия:**
- Просмотр/Редактирование
- Верификация (подтвердить документы)
- Настроить Carrier (создать/редактировать запись carriers)
- Заблокировать

---

### 3.4 Настройки перевозчиков (/admin/carriers)

**Это ключевой раздел!** Здесь админ создаёт и настраивает записи в таблице `carriers`.

#### Форма создания/редактирования Carrier:

```
┌─────────────────────────────────────────────────────────────┐
│  Настройка перевозчика                                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Компания: [Выбор из списка компаний типа carrier]     ▼   │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│  ОСНОВНЫЕ НАСТРОЙКИ                                         │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  Тип API:  ○ Manual (ручной расчёт)                        │
│            ○ DHL API                                        │
│            ○ FedEx API                                      │
│            ○ UPS API                                        │
│            ○ Ponyexpress API                                │
│            ○ Custom API                                     │
│                                                             │
│  Статус:   [✓] Активен                                     │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│  ПОДДЕРЖИВАЕМЫЕ НАПРАВЛЕНИЯ                                 │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  Типы перевозок:                                            │
│    [✓] Авиа (air)                                          │
│    [✓] Морской (sea)                                       │
│    [✓] Ж/Д (rail)                                          │
│    [✓] Автомобильный (road)                                │
│                                                             │
│  Страны отправления:                                        │
│    [Казахстан] [Китай] [Россия] [+ Добавить]               │
│                                                             │
│  Страны назначения:                                         │
│    [Казахстан] [Китай] [Россия] [США] [+ Добавить]         │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│  НАСТРОЙКИ API (если выбран не Manual)                      │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  API Key:      [________________________]                   │
│  API Secret:   [________________________]                   │
│  Account #:    [________________________]                   │
│  Environment:  ○ Sandbox  ○ Production                     │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│  ТАРИФЫ (для Manual типа)                                   │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  Базовая ставка за кг:     [____] USD                      │
│  Минимальная сумма заказа: [____] USD                      │
│  Топливный сбор:           [____] %                        │
│  Страховка:                [____] % от стоимости груза     │
│                                                             │
│                        [Отмена]  [Сохранить]               │
└─────────────────────────────────────────────────────────────┘
```

---

### 3.5 Заказы (/admin/orders)

**Список заказов:**
| Поле | Описание |
|------|----------|
| № заказа | VE-2025-000001 |
| Дата | Дата создания |
| Заказчик | Компания-отправитель |
| Перевозчик | Выбранный перевозчик |
| Маршрут | Откуда → Куда |
| Сумма | Стоимость заказа |
| Комиссия | 5% от суммы |
| Статус | pending/confirmed/delivered и т.д. |
| Оплата | Оплачен/Не оплачен |

**Фильтры:**
- По статусу
- По перевозчику
- По дате
- По сумме

**Действия:**
- Просмотр деталей
- Изменить статус (в экстренных случаях)
- Связаться с участниками

---

### 3.6 Счета и платежи (/admin/invoices)

**Список счетов:**
| Поле | Описание |
|------|----------|
| № счёта | INV-2025-000001 |
| Заказ | Связанный заказ |
| Компания | Кому выставлен |
| Сумма | Сумма к оплате |
| Срок оплаты | due_date |
| Статус | pending/paid/overdue |
| Оплачен | Дата оплаты |

**Действия:**
- Отметить как оплаченный
- Отправить напоминание
- Скачать PDF

---

### 3.7 Отзывы (/admin/reviews)

**Модерация отзывов:**
- Просмотр всех отзывов
- Скрытие/удаление неуместных
- Ответ от имени платформы

---

### 3.8 Настройки системы (/admin/settings)

**Разделы:**

1. **Общие настройки**
   - Название платформы
   - Логотип
   - Контактные данные

2. **Финансовые настройки**
   - Размер комиссии (по умолчанию 5%)
   - Срок постоплаты (по умолчанию 15 дней)
   - Валюта по умолчанию

3. **Email настройки**
   - SMTP конфигурация
   - Шаблоны писем

4. **Интеграции**
   - API ключи для DHL, FedEx и т.д. (глобальные)
   - Настройки карт (Google Maps / Yandex)
   - AI настройки (OpenAI ключ для чат-бота)

5. **Безопасность**
   - Логи действий администраторов
   - Настройки 2FA

---

## 4. Роли администраторов

| Роль | Права |
|------|-------|
| Super Admin | Полный доступ ко всему |
| Admin | Всё кроме настроек системы |
| Moderator | Верификация компаний, модерация отзывов |
| Support | Только просмотр, ответы в чатах |

---

## 5. Технические детали

### Backend (Laravel)
- Отдельные контроллеры в `App\Http\Controllers\Admin\`
- Middleware `admin` для проверки роли
- Policy для каждой модели

### Frontend (Vue.js)
- Отдельный layout для админки
- Роутинг с guard `requiresAdmin`
- Компоненты в `/src/views/admin/`

---

## 6. Порядок реализации

### Фаза 1: Базовая функциональность
1. [ ] Layout админ-панели
2. [ ] Dashboard со статистикой
3. [ ] CRUD пользователей
4. [ ] CRUD компаний

### Фаза 2: Управление перевозчиками
5. [ ] Верификация компаний
6. [ ] Создание/редактирование Carrier записей
7. [ ] Настройка тарифов для Manual перевозчиков

### Фаза 3: Заказы и финансы
8. [ ] Управление заказами
9. [ ] Управление счетами
10. [ ] Отчёты и экспорт

### Фаза 4: Дополнительное
11. [ ] Модерация отзывов
12. [ ] Настройки системы
13. [ ] Логирование действий

---

## 7. Примечания

- При регистрации компании типа `carrier` - автоматически создавать запись в `carriers` со статусом `is_active = false`
- После верификации и настройки - админ активирует перевозчика
- Перевозчик сам может редактировать свои тарифы через "Панель перевозчика"
